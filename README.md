## логика обработки товара в заказе

**Обязательное перемещение** - то перемещение которое формируется для нужд заказов. При закрытии и получении не оказывают влияния на кол-во на складе. (тк уже учтены в заказах, тое находятся в них)

**Необязательное перемещение** - пермещение сформированное вручную, оказывают влияние на склад при получении и формировании, пополняют и списывают соотв.



**События:**

### Поступление заказа на N товара.

Проверяем количество на складе сопряженных с тем где осуществлен заказ.

Если кол-во(S - store) >= N то списываем(S-N) с этого склада и завершаем обработку.

Другой случай если S < N то списываем что есть и проверяем кол-во в необязательных перемещениях. 

При том теперь N = N - S (если значение положительное), тое это необходимый остаток.

Если товар обнаружен в необязательных закрытых (тое уже сформированных) перемещениях(T - transaction) на этот склад то переводим кол-во T - N из необязательных в обязательное перемещения(закрытые).

При том теперь N = N - R (если N >= R) или N = 0 тое это необходимый остаток.

Если N = 0 завершаем, если нет продложаем смотреть на другом складе.

Если товар(на удаленном складе) отсутствует присваиваем отрицательное кол-во на текущем складе (S-N).

Если товар присутствует на другом складе(R - remote) списываем его оттуда. 

Два случая: Если R >= N то теперь осаток на уделенном складе R - N и формирется обязательное перемещение на N товаров.

Второй случай если R < N, то списываем R товара и формируем обязательное перемещение на R товара. Так же записываем на текущем складе остаток 
S-N


### Изменение кол-ва в заказе на повышение (U)
Выполняем все действия из пункта **Поступление заказа на N товара** при N = D

### Изменение кол-ва в заказе на понижение (D)
Производим поиск обязятельных перемещений, возможны следующие случаи:
Перемещений нет - то пополняем текущий склад на D товаров. (если товар не является виртуальным)
Есть закрытые перемещения(С - closed) то 
Есть открытые перемещения(O - open) то 

